åœ°å›¾åœºæ™¯æµç¨‹ç°åœ¨æ˜¯å®Œå…¨æ•°æ®é©±åŠ¨çš„ï¼Œæµç¨‹éå¸¸çº¿æ€§ä¸”é€»è¾‘åˆ†æ˜ã€‚
1. åœºæ™¯åˆå§‹åŒ– (WorldScene.init)
åŠ è½½èµ„æº: åŠ è½½åœ°å›¾èƒŒæ™¯å’Œæ‰€éœ€çš„ Spriteã€‚
åˆ›å»ºå®ä½“:
åŠ è½½ player å®ä½“ã€‚
åŠ è½½ npc / enemy å®ä½“ï¼šFactory ä¼šè‡ªåŠ¨ç»™å®ƒä»¬æŒ‚ä¸Š trigger (æ„Ÿåº”å™¨) å’Œ action (è¡Œä¸º) ç»„ä»¶ã€‚
[æ–°] å®ä½“åŒ– Portals: WorldScene ä¼šè¯»å–åœ°å›¾é…ç½®é‡Œçš„ portals æ•°ç»„ï¼ŒæŠŠæ¯ä¸ªä¼ é€ç‚¹éƒ½å˜æˆä¸€ä¸ªä¸å¯è§çš„ã€å¸¦æœ‰ ZONE ç±»å‹çš„ Trigger å®ä½“ã€‚
2. æ¸¸æˆå¾ªç¯ (æ¯å¸§ update)
æ¯ä¸€å¸§ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿è½¬ï¼š
Step 1: ç‰©ç†ä¸è¾“å…¥ (Physics & Input)
InputSystem: è¯»å–ç©å®¶æŒ‰é”®ã€‚
MovementSystem: æ›´æ–°æ‰€æœ‰å®ä½“çš„ä½ç½®ã€‚
ConstraintSystem: ç¡®ä¿ç©å®¶ä¸è·‘å‡ºåœ°å›¾è¾¹ç•Œã€‚
Step 2: è§¦å‘å™¨æ£€æµ‹ (TriggerSystem) ğŸ§ 
è¿™æ˜¯æ–°çš„å¤§è„‘ã€‚å®ƒéå†æ‰€æœ‰å¸¦æœ‰ trigger ç»„ä»¶çš„å®ä½“ï¼Œåšçº¯æ•°å­¦æ£€æµ‹ï¼š
åŒºåŸŸæ£€æµ‹ (ZONE): ç©å®¶æœ‰æ²¡æœ‰è¸©è¿›ä¼ é€é—¨çš„çŸ©å½¢åŒºåŸŸï¼Ÿ
è·ç¦»æ£€æµ‹ (PROXIMITY): ç©å®¶æœ‰æ²¡æœ‰å¤ªé è¿‘æ•Œäººï¼Ÿ
äº¤äº’æ£€æµ‹ (INTERACT): ç©å®¶æœ‰æ²¡æœ‰åœ¨ NPC æ—è¾¹æŒ‰ä¸‹ç©ºæ ¼é”®ï¼Ÿ
å¦‚æœæ¡ä»¶æ»¡è¶³ -> å®ƒä¼šç»™è¯¥å®ä½“æ‰“ä¸Šä¸€ä¸ª triggered (å·²è§¦å‘) çš„æ ‡ç­¾ç»„ä»¶ã€‚
Step 3: UI æç¤º (InteractionSystem) ğŸ‘ï¸
å®ƒåªåšä¸€ä»¶äº‹ï¼šæ£€æŸ¥ç©å®¶é™„è¿‘æœ‰æ²¡æœ‰å¯ä»¥äº¤äº’çš„ NPCã€‚
å¦‚æœæœ‰ï¼Œé€šçŸ¥ Vue å±‚æ˜¾ç¤º "æŒ‰ E äº¤äº’" çš„æç¤ºæ¡†ã€‚ï¼ˆç›®å‰ä»£ç é‡Œè™½ç„¶æœªè¿æ¥å®é™… UIï¼Œä½†é€»è¾‘ä¿ç•™åœ¨è¿™é‡Œï¼‰ã€‚
Step 4: è¡Œä¸ºæ‰§è¡Œ (ActionSystem) âš¡
è¿™æ˜¯æ‰§è¡Œè€…ã€‚å®ƒæŸ¥æ‰¾æ‰€æœ‰å¸¦æœ‰ triggered æ ‡ç­¾çš„å®ä½“ï¼Œå¹¶æ ¹æ®å®ä½“èº«ä¸ŠæŒ‚çš„å…¶ä»–ç»„ä»¶æ¥å†³å®šåšä»€ä¹ˆï¼š
æœ‰ actionBattle ç»„ä»¶? -> æš‚åœæ¸¸æˆï¼Œå›è°ƒ onEncounter è¿›å…¥æˆ˜æ–—åœºæ™¯ã€‚
æœ‰ actionTeleport ç»„ä»¶? -> å›è°ƒ onSwitchMap åˆ‡æ¢åœ°å›¾ã€‚
æœ‰ actionDialogue ç»„ä»¶? -> æš‚åœæ¸¸æˆï¼Œå›è°ƒ onInteract æ˜¾ç¤ºå¯¹è¯æ¡†ã€‚
æ‰§è¡Œå®Œåï¼Œç§»é™¤ triggered æ ‡ç­¾ï¼ˆé˜²æ­¢ä¸‹ä¸€å¸§é‡å¤è§¦å‘ï¼‰ã€‚
Step 5: æ¸²æŸ“ (RenderSystem) ğŸ¨
æŠŠæ‰€æœ‰å®ä½“ç”»åˆ°å±å¹•ä¸Šã€‚


graph TD
    Start(æ¯å¸§å¼€å§‹) --> Input[InputSystem: ç©å®¶ç§»åŠ¨]
    Input --> Physics[MovementSystem: æ›´æ–°åæ ‡]
    Physics --> Trigger[TriggerSystem: æ£€æµ‹æ¡ä»¶]
    
    Trigger --æ»¡è¶³æ¡ä»¶--> Tag(ç»™å®ä½“æ‰“ä¸Š Triggered æ ‡ç­¾)
    
    Trigger --> UI[InteractionSystem: UI æç¤º]
    UI --> Action[ActionSystem: æ£€æŸ¥ Triggered æ ‡ç­¾]
    
    Action --æœ‰ actionBattle--> Battle(è¿›å…¥æˆ˜æ–—)
    Action --æœ‰ actionTeleport--> Map(åˆ‡æ¢åœ°å›¾)
    Action --æœ‰ actionDialogue--> Dialogue(æ˜¾ç¤ºå¯¹è¯)
    
    Action --> Render[RenderSystem: ç»˜åˆ¶ç”»é¢]